---
title: "Documentation of the extension of the fisheries composition dataset"
author:
- "Lucia Segovia de la Revilla"
- "Thomas Codd"
- "Liberty Mlambo"
- "Louise Ander"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  bookdown::html_document2: 
   pdf_document: 
    fig_caption: true
editor_options:
  markdown:
    wrap: 72
    
link-citations: yes
bibliography: mylibrary.bib
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)
knitr::read_chunk("visualisation.R")

library(gt)

```

## SUMMARY

**insert image (flowchart)**

1.  Identifying the data:

QC1: Evaluate the quality of the dataset and the documentation
accompanying the dataset.

2.  Importing the data into R: This step is going to depend on the
    original (raw) format.

QC2: We will ensure that all the data has been imported and done
correctly. E.g., check that total number of observations and variables
are correctly imported.

3.  Tidying the data: This means we will convert from the original (raw)
    format to a standardised (harmonised) format, by performing all or
    some of the following operations:

<!-- -->

a.  Variable names: Components will be name using Tagnames (upper case)
    and the standard unit (lower case) (e.g., PROTg).

b.  Dividing combined variables into two (or more) columns. E.g.,
    `CARTEB or [CARTEBEQ]` into `CARTEBmg`, `CARTBEQmg`.

c.  *Removing brackets* or other special characters ("[]", "()", "\*").
    E.g., extracting the numeric value from inside the bracket from "low
    quality"/alternative methods. --\> How can we record/ account for it
    within the data?

d.  *Removing summary stat from the table* --\> How can we keep/use that
    data?

e.  Food name/ description standardisation: For instance, for fisheries
    [ASFIS codes](https://www.fao.org/fishery/en/collection/asfis/en)
    will be assigned according to their species and fishery products.

f.  Food groups variable (row to column).

QC3: Check that observations and variables are still the same as the
original dataset, or in line with the previous operations performed, for
instance, if we have divided a column into two, our dataset should have
the same number of variables plus one.

4.  Data transformation: Changes to the original data values will be
    performed and documented.

<!-- -->

a.  Changing characters into numeric. For example, trace ("tr") or below
    detection limit ("\<LOD") will be converted into zero (0).

b.  Changing variable units. For example from mg to g, according to the
    standard reporting units (FAO/INFOODS, 2013).

c.  Combining or Re-calculating variables: Summary statistics will be
    calculated for each FAO ICP codes. For example, energy needs to be
    calculated from other components.

<!-- -->

5.  Visualising the data: missing values and outliers will be plotted
    and identified.

6.  Exporting data and metadata

## Background

**complete this w/ info from the contract and report**

The objective of this deliverable was to expand the preexisting
Fisheries Global NCT for a rage of food components that are very
relevant for fish. The initial list of food components that we evaluated
for inclusion is shown in Table 1 including the reason for inclusion or exclusion.

Table 1: List of food components evaluated for the Fisheries Global NCT expansion. 


| \#  | Food component                  | Inclusion | Reason                                                                        |
|-----|---------------------------------|-----------|-------------------------|
| 1\. | Iodine (I)                      | Excluded  | There were not enough data (Section )|                                                                    
| 2\. | Selenium (Se)                   | Included  |                                                                               |
| 3\. | Copper (Cu)                     | Included  |                                                                               |
| 4\. | Sodium (Na)                     | Excluded  | Main source of Na in the diet is salt which has major recall issues @ref-salt |
| 5\. | Niacin (Nia) (Tryptophan (TRP)) | Included  |   |                       
|6\.  | Vitamin B6                       | Included  | |
|7\.  | Vitamin B12 | Included       |      |
|8\.  | Vitamin D (including D3, D2 and hidroxi forms) | Excluded | There were not enough data (Section ) |
|9\. | Docosapentaenoic acid (DHA) (22:6 (n-3)) | Included | |
|10\.| Eicosapentaenoic acid (EPA) (20:5 (n-3)) | Included| |






### 1. Preparation steps: Identifying and accessing food composition data

#### 1. 1. Food composition tables for compiling the Fisheries Global Nutrient Conversion Table

Thirteenth Food Composition Tables and Databases (FCTs) were reviewed
and included to generate a Global Nutrient Conversion Table (NCT). For
the Fisheries Global NCT, two were excluded: uPulses FCT (2016) and the
Composition of foods integrated dataset (CoFID, 2021). The later was excluded
because it did not improve the overall data quality (e.g., it did not filled any of the data gaps), however it was process and it
could be added in the future. The former was excluded for obvious
reasons, as the data were not relevant for fisheries (i.e., only
reported pulses).

Of the eleven FCT, three FCTs were not publicly available and, we
requested access to the FAO Team. Access was granted and was covered by
the LOI containing the data sharing agreement. In addition, because the FCTs included were
previously reviewed by the FAO team, there was no need of checking the
overall quality of the FCTs.

Then, we reviewed the availability of ten pre-selected food components:
Copper, (Cu), Iodine (I), Selenium (Se), Vitamin B6 (Vit. B6), Vitamin
B12 (Vit. B12), Vitamin D (Vit. D), Niacin, Docosapentaenoic acid (DHA),
Eicosapentaenoic acid (EPA) (See Table 2) in the 11 FCTs. Some data gaps
were found for those components in the previously reviewed FCTs, hence
we reviewed other possible sources of nutrient values (e.g. The
Norwegian FCDB, 2021).

#### 1. 2. Identifying new potential sources of food components

We reviewed some FCTs that could provide information on fish and fishery
products for the pre-defined nutrients of interest. Some potential
candidates were FCTs of countries or region with potentially high
consumption of fish: Ciqual FCDB (France), 2019, Norway FCDB, 2021,
ASEAN FCDB, 2014.

When assessing quality and availability of data, we used the FAO/INFOODS
framework (screening questions) to identify potential source of nutrient
values. This led to the inclusion of the Norwegian FCDB, 2021. Because,
it was the only new FCDB included which was not previously reviewed by
the FAO team, we checked the original values of the Norwegian FCDB, 2021
(NO21) in depth, which is discussed in the \*\*Section 2.1\*\* of the
protocol of the [NO21](NO21/NO21_docu.Rmd).

In table 2, we can find information on the final list of FCTs
included.

Table 2. List of all the FCTs included, and description of their access,
format and reviewing team.

| BiblioID | Reference                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Link to access original data                                                                | Access                                                                                     |       Format       | Reviewer |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|:------------------:|----------|
| US19     | US Department of Agriculture (USDA), Agricultural Research Service, Nutrient Data Laboratory. USDA National Nutrient Database for Standard Reference, Legacy. Version Current: April 2019.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | <http://www.ars.usda.gov/nutrientdata>                                                      | Publicly available                                                                         |       Access       | FAO      |
| AU19     | Food Standards Australia New Zealand (FSANZ). 2019. The Australian Food Composition Database, release 1 \\[online\\]. Canberra.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | <http://www.foodstandards.gov.au>                                                           | Internal                                                                                   |       excel        | FAO      |
| NZ18     | New Zealand Food Composition Database. 2019. New Zealand FOODfilesTM 2018 Manual. The New Zealand Institute for Plant and Food Research Limited and Ministry of Health.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | <http://www.foodcomposition.co.nz/foodfiles>                                                | Publicly available                                                                         |       excel        | FAO      |
| UK21     | Food Standards Agency. 2021. McCance and Widdowson's The Composition of Foods Integrated Dataset (CoFID) 2021. London, Institute of Food Research, Public Health England.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                             | <https://www.gov.uk/government/publications/composition-of-foods-integrated-dataset-cofid> | publicly available | excel    |
| DK19     | Frida, DTU Foods public food database, version 4, 2019, National Food Institute, Technical University of Denmark.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | <https://frida.fooddata.dk>                                                                 | Publicly available                                                                         |       excel        | FAO      |
| WA19     | Vincent, A., Grande, F., Compaoré, E., Amponsah Annor, G., Addy, P.A., Aburime, L.C., Ahmed, D., Bih Loh, A.M., Dahdouh Cabia, S., Deflache, N., Dembélé, F.M., Dieudonné, B., Edwige, O.B., Ene-Obong, H.N., Fanou Fogny, N., Ferreira, M., Omaghomi Jemide, J., Kouebou, P.C., Muller, C., Nájera Espinosa, S., Ouattara, F., Rittenschober, D., Schönfeldt, H., Stadlmayr, B., van Deventer, M., Razikou Yiagnigni, A. & Charrondière, U.R. 2020. FAO/INFOODS Food Composition Table for Western Africa (2019) User Guide & Condensed Food Composition Table / Table de composition des aliments FAO/INFOODS pour l'Afrique de l'Ouest (2019) Guide d'utilisation & table de composition des aliments condensée. Rome, FAO. | <https://www.fao.org/fileadmin/user_upload/faoweb/2020/WAFCT_2019.xlsx>                     | Publicly available                                                                         |       excel        | FAO      |
| KE18     | FAO & Government of Kenya. 2018. Kenya Food Composition Tables [online]. Nairobi.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | <http://www.kilimo.go.ke/wp-content/uploads/2018/10/KENYA-FOOD-COMPOSITION-TABLES-2018.pdf> | Publicly available                                                                         |       excel        | FAO      |
| IN17     | Longvah, T., Ananthan, R., Bhaskarachary, K. & Venkaiah, K. 2017. Indian Food Composition Tables. Hyderabad, India, National Institute of Nutrition.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <http://www.ifct2017.com/frame.php?page=home>                                               | Internal                                                                                   |       excel        | FAO      |
| JA15     | MEXT. (2015).The Standard Tables of Food Composition in Japan 2015 (Seventh Revised Edition). Official Gazette Co-operation of Japan. Japan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <http://www.mext.go.jp/a_menu/syokuhinseibun/1365451.htm/>                                  | Publicly available                                                                         |       excel        | FAO      |
| BA13     | Shaheen N., Rahim A.T.M.A., Mohiduzzaman Md., Banu C.P., Bari Md. L., Tukun A.B., Mannan M.A., Bhattacharjee L., Stadlmayr B. 2013. Food Composition Table for Bangladesh. Institute of Nutrition and Food Science, Centre for Advanced Research in Sciences, University of Dhaka.                                                                                                                                                                                                                                                                                                                                                                                                                                             | <https://www.fao.org/fileadmin/templates/food_composition/documents/FCDB_7_4_14.xlsx>       | Publicly available                                                                         |       excel        | FAO      |
| BR11     | Nucleo de Estudos e pesquisas em Alimentacao (NEPA). Brazilian Food Composition Table (TACO), 4th ed., 2011.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | <https://www.nepa.unicamp.br/taco/tabela.php?ativo=tabela>                                  | Internal                                                                                   |       excel        | FAO      |
| UF16     | FAO. 2016. FAO/INFOODS Global Food Composition Database for Fish and Shellfish. Version 1.0 -- uFiSh1.0. Rome.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | <http://www.fao.org/infoods/infoods/tables-and-databases/faoinfoods-databases/en/>).        | Publicly available                                                                         |       excel        | FAO      |
| UP17[^1] | FAO. 2017. FAO/INFOODS Global Food Composition Database for Pulses. Version 1.0 -- uPulses 1.0. Rome.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | <http://www.fao.org/infoods/infoods/tables-and-databases/faoinfoods-databases/en/>).        | Publicly available                                                                         |       excel        | FAO      |
| NO21     | Norwegian Food Composition Database 2021. Norwegian Food Safety Authority.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | <https://www.matportalen.no/verktoy/the_norwegian_food_composition_table/>                  | Publicly available                                                                         |       excel        | UoN      |

[^1]: Note: UP17 was not process because we were only interested in fish

## Harmonisation of the food composition tables and databases (method)

The harmonisation required two main steps: importing (loading) databases
into R and cleaning and standardising the databases.

### 1. Importing the data

Datasets were found in a variety of formats that needed to be imported
and cleaned into a tabular format. E.g. one row per food item and one
column per variable (food attribute, for example, energy, protein).

The steps and scripts for importing each FCT are stored together with
the original FCT (raw files) in individual folders named with the
BiblioID (See table 2) which is stored in the variable `source_fct` (See
table 3).

### 2. Tidying the data

In order to merge all data from various FCTs into one common library, we needed to harmonise the
information in each dataset. The steps that were taken are explained
below and annotated scripts for each FCTs can be found in this
repository in each corresponding folder, as previously mentioned.

#### 2.1. Renaming variable names

Each FCT has its own variable names, including for nutrient values. Some
FCTs included information related to the FAO/ INFOODS food components
identifiers
[(Tagnames)](https://www.fao.org/infoods/infoods/standards-guidelines/food-component-identifiers-tagnames/en/)

while other did not. In order to merge all data from various FCTs we
need to harmonise the names of all the variables and particularly the
food components of interest. To do so, we evaluated and renamed them
with the most appropriate Tagname. Other variables (e.g., food id, food
name or food description) were renamed to a common variable name, for
instance, `fdc_id`, `food_desc`, following the variable names used in
the Fisheries Global NCT file.

**The identification of food components**

Information on the food components and their description should be
sought in each FCT included. We reviewed the Tagnames used in the
previous version of the  Fisheries Global NCT (Feb, 2022) for generating the same structure and format in our
output table (More information about final format in Section 5.1). Some minor changes in the variable names were introduced
to be compliant with R conventions. E.g., removing spaces in variable
names, changing symbols to characters (e.g., µg to mcg), or
standardising the name formatting from using underscores and/or
parenthesis to using only underscores. Also, changing dashes (-) to
underscores (\_). Note that within the Tagnames, the dash is used to
denote that the method for obtaining that (component) value is unknown.
This is important for the quality assessment of the data.

Also, we also assumed that all the variables labelled as "standardised"
were combined or recalculated variables.

Table 2 provides a list of all the variables including food components used
in the previous version of the Fisheries Global NCT (Feb., 2022).
## Need completion of table 2 - 
**Table 2.**: List of variable names (including Tagnames), description
and reference for the Tagnames, and type of value (compiled or calculated).

| Variable name          | Description     |  Reference | Value type       |
|------------------------|------------------|-----------|------------------|

| fdc_id                 | Food identifier as per original source (FCT)  |          | -                      | Compiled          |
| food_desc              | Food name and description as per original source (FCT) | | -                      |    Compiled          |
| food_group             | Food group as per original source (FCT)  |               | -                      | Compiled          |
| scientific_name        | Scientific name of the food            |                 | -                      | Compiled          |
| source_fct             | Id. of the FCT (BiblioID), see Table 1  |
| -                      | Generated         |
| nutrient_data_source   | References or data source for the nutrient values |
| -                      | Compiled          |
| Edible_factor_in_FCT   | Edible portion reported as fraction edible, imputed from the original FCT, or calculated from refuse in the FCT         |                    | -                       | Compiled          |
| Edible_desc            | Information provided on the edible portion |
| -                      | Compiled          |
| specific_gravity       | Density reported in the original units as in the original FCT   |                                                                            
| -                      | Compiled          |
| SOPg                   | Sum of Proximate in g per 100g EP as reported in the original FCT  |
| -                      | Compiled          |
| SOPg_std               | Sum of Proximate in g per 100g EP (Eq. 3.3)   |          | -                      | Calculated        |
| ASHg                   | Ashes in g per 100g of EP  |                             | -                      | Compiled          |
| ASHg_std               | Ashes in g per 100g of EP (Eq. 3.4)   |                  | -                      | Calculated        |
| ENERCkJ                | Energy in kJ/ 100g of EP as reported in the original FCT| | -                      | Compiled          |
| ENERCkJ_standardised   | Energy in kJ/ 100g of EP (Eq. 3.5)   |                   | -                      | Calculated        |
| ENERCkcal              | Energy in kcal/ 100g EP as reported in the original FCT | | -                      | Compiled          |
| ENERCkcal_standardised | Energy in kcal/ 100g EP (Eq. 3.5)   |                    | -                      | Calculated        |
| WATERg                 | Water/ moisture content in g per 100g of EP      |       | -                      | Compiled          |
| PROCNTg                | Protein in g per 100g of EP, as reported in the original FCT and assumed to be calculated from nitrogen (NTg) content      |                 |FAO/INFOODS, 2012       | Compiled          |
| NTg                    | Nitrogen, total |                                        FAO/INFOODS, 2012        | Compiled          |
| XN                     | Nitrogen conversion factor       |                       |FAO/INFOODS, 2012       | Compiled          |
| FATg                   | Total fat content in g per 100g of EP. Sum of triglycerides, phospholipids, sterols and related compounds obtained by a mixed solvent extraction   |  
|FAO/INFOODS, 2012        | Compiled          |
| FAT_g                  | fat content unknown method of calculation in g per 100g of EP   |                                                                           | -                      | Compiled          |
| FATCEg                 | Fat content measured using continuous extraction (e.g., Soxhlet method) expressed in g per 100g of EP   |                                   |FAO/INFOODS, 2012        | Compiled          |
| FATg_standardised      | Total fat content in g per 100g of EP regardless of the Tagname (and analytical method used). Including FATg, FAT_g and FATCEg.  |          |-                       | Calculated        |
| CHOAVLDFg              | Available carbohydrates calculated by difference (E.g., 100 - (weight in grams of water + protein + fat + ash + fibre + alcohol in 100 g of food)) imputed from the original source  |                                          |FAO/INFOODS, 2012               | Compiled          |
| CHOAVLg                | Available carbohydrates calculated by weight in g per 100g of EP           |                                                              |FAO/INFOODS, 2012       | Compiled          |
| CHOCSMg                | Carbohydrates, total; calculated by summation. This values is the sum of the sugars, starches, oligosaccharide, and dietary fibre in g per 100g of EP    |                                                                 |FAO/INFOODS, 2012              | Compiled          |
| CHOAVLMg               | Carbohydrates, available in monosaccharide equivalent. This value includes the free sugars plus dextrins, starch, and glycogen in g per 100g of EP    |                                                                    |FAO/INFOODS, 2012       | Compiled          |
| CHOAVLDFg_std          | Available carbohydrates calculated by difference (Eq. 3.6). |                                                                             | -                      | Calculated        |
| FIBTGg                 | Total dietary fibre by AOAC Prosky method expressed in g per 100g of EP      |                                                               |FAO/INFOODS, 2012       | Compiled          |
| NSPg                   | Non-starch polysaccharide, (Englyst fibre) expressed in g per 100g of EP   |                                                                  |FAO/INFOODS, 2012        | Compiled          |
| FIBCg                  | Fibre, crude in g per 100g of EP   |                     |FAO/INFOODS, 2012       | Compiled          |
| ALCg                   | Alcohol in g per 100g   |                                                                                                                                                                                                                                                                                                                                    | Compiled          |
| ALCg_100mL             | Alcohol expressed in g per 100mL                                                                                                                                                                                                                                                                                                                            | Compiled          |
| SUGARg                 | Total sugar (the sum of free mono- and disaccharides) in g per 100g of EP                                                                                                                                                                                                                                                                                   | Compiled          |
| FASATg                 | Fatty acids, total saturated in g per 100g                                                                                                                                                                                                                                                                                                                  | Compiled          |
| FAMSg                  | Fatty acids, total monounsaturated in g per 100g                                                                                                                                                                                                                                                                                                            | Compiled          |
| FAPUg                  | Fatty acids, total polyunsaturated in g per 100g of EP                                                                                                                                                                                                                                                                                                      | Compiled          |
| FATRNg                 | Fatty acids, total trans in g per 100g EP                                                                                                                                                                                                                                                                                                                   | Compiled          |
| F22D6N3g               | Docosahexaenoic acid (DHA) (22:6 n-3) in g/100g of EP                                                                                                                                                                                                                                                                                                       | Compiled          |
| F20D5N3g               | Eicosapentaenoic acid (EPA) (20:5 n-3) in g/100g of EP                                                                                                                                                                                                                                                                                                      | Compiled          |
| CHOLEmg                | Cholesterol determined by enzymatic or chromatographic method in mg per 100g of EP                                                                                                                                                                                                                                                                          | Compiled          |
| CHOL_mg                | Cholesterol by unknown method of determination in mg per 100g of EP                                                                                                                                                                                                                                                                                         | Compiled          |
| RETOLmcg               | Retinol in mcg per 100g of EP                                                                                                                                                                                                                                                                                                                               | Compiled          |
| VITAmcg_std            | Vitamin A (Retinol Eq. (RE) in mcg per 100g of EP calculated using Eq.3.7.                                                                                                                                                                                                                                                                                  |                   |
| Calculated             | FAO/INFOODS, 2012                                                                                                                                                                                                                                                                                                                                           |                   |
| VITAmcg                | Vitamin A (Retinol Eq. (RE) = mcg retinol + 1/6 mcg ß- carotene + 1/12 mcg other pro-vitamin A carotenoids) in mcg per 100g of EP                                                                                                                                                                                                                           | Compiled          |
| VITA_RAEmcg            | Vitamin A (Retinol Activity Eq. (RAE) = mcg retinol + 1/12 mcg ß- carotene + 1/24 mcg other provitamin A carotenoids) in mcg per 100g of EP                                                                                                                                                                                                                 | Compiled          |
| VITA_RAEmcg_std        | Vitamin A (Retinol Activity Eq. (RAE)) in mcg per 100g of EP calculated using Eq.3.6.                                                                                                                                                                                                                                                                       |                   |
| Calculated             | FAO/INFOODS, 2012                                                                                                                                                                                                                                                                                                                                           |                   |
| CARTBEQmcg             | Beta-carotene equivalents, is the sum of the beta-carotene + 1/2 quantity of other carotenoids with vitamin A activity, expressed in mcg per 100g of EP                                                                                                                                                                                                     | Compiled          |
| CARTBEQmcg_std         | Beta-carotene equivalents, expressed in mcg per 100g of EP and calculated using Eq. 3.7. It also can be imputed using function "CARTBEQmcg_std_imputation" (See section 3.4.)                                                                                                                                                                               | Calculated        |
| CARTAmcg               | Alpha-carotene in mcg per 100g of EP                                                                                                                                                                                                                                                                                                                        | Compiled          |
| CARTBmcg               | Beta-carotene in mcg per 100g of EP                                                                                                                                                                                                                                                                                                                         | Compiled          |
| CRYPXBmcg              | Beta-cryptoxanthin in mcg per 100g of EP                                                                                                                                                                                                                                                                                                                    | Compiled          |
| VITEmg                 | Vitamin E calculated by summation of the vitamin E activities of the active tocopherols and tocotrienols expressed as alpha-tocopherol equivalent in mg per 100g of EP (alpha-tocophero eq. = alpha-tocopherol + 0.4 beta-tocopherol + 0.1 gamma-tocopherol+ 0.01 delta-tocopherol+ 0.3 alpha-tocotrienol + 0.05 beta-tocotrienol + 0.01 gamma-tocotrienol) | Compiled          |
| FAO/INFOODS, 2012      |                                                                                                                                                                                                                                                                                                                                                             |                   |
| TOCPHAmg               | Alpha-tocopherol in mg per 100g of EP                                                                                                                                                                                                                                                                                                                       | Compiled          |
| TOCPHBmg               | Beta-tocopherol in mg per 100g of EP                                                                                                                                                                                                                                                                                                                        | Compiled          |
| TOCPHGmg               | Gamma-tocopherol in mg per 100g of EP                                                                                                                                                                                                                                                                                                                       | Compiled          |
| TOCPHDmg               | Delta-tocopherol in mg per 100g of EP                                                                                                                                                                                                                                                                                                                       | Compiled          |
| TOCTRAmg               | Alpha-tocotrienol in mg per 100g of EP                                                                                                                                                                                                                                                                                                                      | Compiled          |
| TOCTRBmg               | Beta-tocotrienol in mg per 100g of EP                                                                                                                                                                                                                                                                                                                       | Compiled          |
| TOCTRGmg               | Gamma-tocotrienol in mg per 100g of EP                                                                                                                                                                                                                                                                                                                      | Compiled          |
| THIAmg                 | Thiamin, vitamin B1 analysed and expressed as thiamin in mg per 100g of EP                                                                                                                                                                                                                                                                                  | Compiled          |
| THIAHCLmg              | Thiamin hydrochloride, vitamin B1 analysed and expressed as thiamin hydrochloride in mg per 100g of EP                                                                                                                                                                                                                                                      | Compiled          |
| RIBFmg                 | Riboflavin (Vitamin B2) in mg per 100g of EP                                                                                                                                                                                                                                                                                                                | Compiled          |
| VITB6Amg               | Vitamin B6 determined by analysis in mg/100g of EP                                                                                                                                                                                                                                                                                                          | Compiled          |
| VITB6Cmg               | Vitamin B6 determined by calculation (sum of pyridoxal, pyridoxamine and pyridoxine) in mg per 100g EP                                                                                                                                                                                                                                                      | Compiled          |
| VITB6_mg               | Vitamin B6 by unknown method in mg/100g of EP                                                                                                                                                                                                                                                                                                               | Compiled          |
| VITB6_mg_standardised  | Vitamin B6 in mg/100g of EP regardless of the Tagname (and analytical method used). Including VITB6Amg, VITB6Cmg and VITB6_mg.                                                                                                                                                                                                                              | Compiled          |
| FOLDFEmcg              | Dietary folate equivalents calculated as food folate + 1.7 x synthetic folic acid and expressed in mcg per 100g of EP                                                                                                                                                                                                                                       | FAO/INFOODS, 2012 |
| FOLmcg                 | Folate, total (food folate + synthetic folic) in mcg per 100g EP. Includes both conjugated and free folate (determined by microbiological assay)                                                                                                                                                                                                            | Compiled          |
| FOLACmcg               | Folic acid. Synthetic folic acid used in fortification and expressed in mcg per 100g EP                                                                                                                                                                                                                                                                     | Compiled          |
| FOLFDmcg               | Folate food, naturally occurring food folate (determined by microbiological assay) in mcg per 100g EP                                                                                                                                                                                                                                                       | Compiled          |
| FOLSUMmcg              | Folate, sum vitamers in mcg per 100g EP. It includes mostly tetrahydrofolate, 5-methyltetrahydrofolate, 5-formyltetrahydrofolate, 10-formylfolic acid, 10-formyldihyrdofolate and folic acid (determined by HPLC)                                                                                                                                           |                   |
| Compiled               | \-                                                                                                                                                                                                                                                                                                                                                          |                   |
| FOL_mcg                | Folate total, unknown method                                                                                                                                                                                                                                                                                                                                | Compiled          |
| NIAEQmg                | Niacin equivalents, total. Preformed niacin plus niacin equivalents from tryptophan (TRP) in mg per 100g EP                                                                                                                                                                                                                                                 | Compiled          |
| NIAmg                  | Niacin, prefrormed in mg per 100g EP                                                                                                                                                                                                                                                                                                                        | Compiled          |
| NIATRPmg               | Niacin equivalents, from tryptophan. 1/60 x tryptophan (TRP) expressed in mg per 100g EP                                                                                                                                                                                                                                                                    | Compiled          |
| TRPmg                  | Tryptophan in mg per 100g of EP (includes only L-tryptophan)                                                                                                                                                                                                                                                                                                |                   |
| Compiled               | Tagnames, 2007 (accessed on 2022-06-08)                                                                                                                                                                                                                                                                                                                     |                   |
| VITB12mcg              | Vitamin B12 (cobalamin, including all the active forms in foods) expressed in mcg per 100g EP                                                                                                                                                                                                                                                               | Compiled          |
| VITCmg                 | Vitamin C (L-ascorbic acid plus Ldehydro-ascorbic acid). Usually analyzed by HPLC and expressed in mg per 100g of EP                                                                                                                                                                                                                                        | Compiled          |
| ASCLmg                 | L-ascorbic acid in mg per 100g of EP. Titrimetry can normally analyze L-ascorbic acid only                                                                                                                                                                                                                                                                  | Compiled          |
| VITDEQmcg              | Vitamin D calculated as the sum of Vitamin D3 + D2 + 5 x 25-hydroxycholecalciferol and expressed in mcg per 100g of EP                                                                                                                                                                                                                                      | Compiled          |
| VITDmcg                | Vitamin D calculated by summation of ergocalciferol and cholecalciferol and expressed in mcg per 100g of EP. This definition is mostly used                                                                                                                                                                                                                 | Compiled          |
| CHOCALmcg              | Cholecalciferol (D3) in mcg per 100g of EP                                                                                                                                                                                                                                                                                                                  | Compiled          |
| ERGCALmcg              | Ergocalciferol (D2) in mcg per 100g of EP                                                                                                                                                                                                                                                                                                                   | Compiled          |
| CHOCALOHmcg            | 25-hydroxycholecalciferol in mcg per 100g of EP                                                                                                                                                                                                                                                                                                             | Compiled          |
| ERGCALOHmcg            | 25-hydroxyergocalciferol                                                                                                                                                                                                                                                                                                                                    | Compiled          |
| CAmg                   | Calcium in mg per 100g of EP                                                                                                                                                                                                                                                                                                                                | Compiled          |
| MGmg                   | Magnesium in mg per 100g of EP                                                                                                                                                                                                                                                                                                                              | Compiled          |
| MNmg                   | Manganese in mg per 100g of EP                                                                                                                                                                                                                                                                                                                              | Compiled          |
| Pmg                    | Phosphorus in mg per 100g of EP                                                                                                                                                                                                                                                                                                                             | Compiled          |
| FEmg                   | Iron in mg per 100g of EP                                                                                                                                                                                                                                                                                                                                   | Compiled          |
| NAmg                   | Sodium in mg per 100g of EP                                                                                                                                                                                                                                                                                                                                 | Compiled          |
| Kmg                    | Potassium in mg per 100g of EP                                                                                                                                                                                                                                                                                                                              | Compiled          |
| CUmg                   | Copper in mg per 100g of EP                                                                                                                                                                                                                                                                                                                                 | Compiled          |
| ZNmg                   | Zinc in mg per 100g of EP                                                                                                                                                                                                                                                                                                                                   | Compiled          |
| SEmcg                  | Selenium in mcg per 100g of EP                                                                                                                                                                                                                                                                                                                              | Compiled          |
| IDmcg                  | Iodine in mcg per 100g of EP                                                                                                                                                                                                                                                                                                                                | Compiled          |

#### 2.2. Other tidying operations <br>

**a. Diving combined variables into two (or more) columns.** For
example, when two components (Tagnames) were reported in the same column
and identified using brackets ([]) around the component values.
(`CARTEB or [CARTEBEQ]`) were separated into two independent columns and
bracket removed (`CARTEBmg`, `CARTBEQmg`).

**b. Removing brackets or other special characters ("[]", "()", "\*")**.
Similarly, special character were used to denote "low quality values"
and/or alternative (determination) methods. For those cases, the numeric
value was extracted and the special character removed. For future
development, a way of keeping that information should be found (e.g, how
can we record and account for those low quality values within the
dataset?, can we generate a score with the number of "low quality"
values per food item?).

**c. Removing summary statistics from the table.** Because summary
statistics will not be used, data were removed. For future development,
a way to account for variability (e.g., using the summary stats) could
be studied (How can we keep/use that data?, could we use them to account
for uncertainty in the final results?).

**d. Food name/ description standardisation.** The ASFIS list was used
for identification of the fish and fishery products. The ISSCAAP and the
3-alpha codes were assigned to fishery products for identification and
name standardisation. The ISSCAAP codes were also used for assigning the
FAO ICP code. The FAO ICP code were extracted from previous work
reported in Fisheries Global NCT, 2022, except for NO21 which was done
semi-manually using R scripts (`NO21/NO21.R`) and it is reported in
(`NO21/NO21_docu.Rmd`).

**e. Food groups variable.** Some food composition tables reported food
groups that were placed as the first row of each category. Those rows
were extracted and allocated as a new attribute of each food/fish entry
(i.e., from row to new column (`food_group`)).

### 3. Data transformation

Some variables needed more than just renaming to allow comparison.

#### 3.1. Changing characters into numeric <br>

To perform mathematical operations, characters needed to be converted
into numeric operator. For instance, values that were reported to be
trace ("tr") or below the detection limit ("\<LOD") were converted to
zero (0).

#### 3.2. Changing variable units <br>

To standardise and merge the different FCTs, food components need to be
reported in the same units. For example, some nutrients needed to be
convert from mg/100g to g/100g, or from percentage (100%) to a fraction (1). For
all the unit conversion we followed the FAO/INFOODS Guidelines for
Converting Units, Denominators and Expression (FAO/INFOODS, 2012b), and
the suggested standard reporting units.

Eg. Converting alcohol from weight in volume (w/v) to weight in mass (w/m).

**Eq.1** ALC (g/100mL) / density (g/mL) = ALC (g/100 EP)

Eg. amino acids (AA) reported per g in 100g of PROT to mg in 100g of EP:

**Eq.2.1** AA mg/100g EP = AA mg/g prot \* prot g/100g EP /100

**Eq.2.2** AA mg/100g EP = AA g/ 100g prot \* prot g/100g EP /100 \*
1000/100

**Eq.2.3** AA mg/100g EP = AA g/100g prot \* prot g/100g EP \*10

**Eq.3.1** Edible portion = Edible portion (%)/100


#### 3.3. Producing the harmonised data library

Once the FCTs were loaded and harmonised, we combined them into a single
data file (data library), extracted from each FCT the fish and fishery product items and merged the
information already provided by the FAO team regarding each fish item
ISSCAAP, ICS FAOSTAT and alpha-three codes.

All the steps were done and documented in the `merging_all.R` script.

#### 3.4. Re-calculating variables <br>

Some variables were calculated from other variables, some of those were: Sum of proximate, Energy (kcal, kJ), or carbohydrates available, by difference among others (See Eq.3.2-6.3) according to the FAO/ INFOODS guidelines (@ref-). There were special cases were back calculation from one or more
food components were used to complete missing values. For example:


1. Ash: These values which are needed to calculate Available carbohydrate by
difference. In the NO21, ash values were not reported, however, because
available carbohydrates were analysed, we used the an iteration of the
\Eq. 3.4a to calculate ash concentration (Eq.3.4b).

1. Ash: These values which are needed to calculate Available carbohydrate by
difference. In the NO21, ash values were not reported, however, because
available carbohydrates were analysed, we used the an iteration of the
\Eq. 3.4a to calculate ash concentration (Eq.3.4b).

2.  Retinol: For instance, when a food entry was missing the retinol
value (`RETOLmcg`) but it reported Vitamin A (RAE) (`VITA_RAEmcg`)
and Beta-Carotene eq. (`CARBEQmcg`). The retinol was calculated
using the [Eq.8.3a](\LINK). Additionally, when Vitamin A (RAE)
(`VITA_RAEmcg`) and Vitamin A (RAE) (`VITAmcg`) was provided,
retinol as calculated by the [Eq.8.3b](LINK). This function
added a comment (see `comment`) with information about the
components that were used to impute the final `RETOLmcg` value. If
no comment was provided, then it was provided by the original food
composition source. More information about the development of the
function is provided in Issue #46.

3. Beta-carotene equivalent: For instance, when the carotenoids were not available in the FCTs to re-calculate Beta-carotene equivalent, two approach were taken for avoiding missing values. Firstly, if Beta-carotene equivalent was reported it was used. Secondly, if it was not reported then, if retinol and Vitamin A were reported, Beta-carotene equivalent was back calculated from those values using the Eq. 7..
    


**Eq.3.2** Edible portion = 100-Refuse (%)/100

**Eq.3.3** Edible portion = 1-Refuse  

**Eq.4** Sum of Proximate (g/100g) = Sum of water + protein + fat +
available carbohydrates + dietary fibre + alcohol + ash

**Eq.6a** Carbohydrates available by difference (g/100g) = 100 - (sum
of water + protein + fat + ash + alcohol + dietary fibre)

**Eq.6b** Ash by difference (g/100g) = 100 - (sum of water + protein +
fat + *available carbohydate* + alcohol + dietary fibre)

**Eq.5.1** Energy (kJ/100g EP): sum of protein (g/100g EP)\*17 + available carbohydate (g/100g EP)\*17 + fat(g/100g EP)\*37 +  alcohol (g/100g EP)\*29 + dietary fibre (g/100g EP)\*8

**Eq.5.2** Energy (kcal/100g EP):  sum of protein (g/100g EP)\*4 + available carbohydate (g/100g EP)\*4 + fat(g/100g EP)\*9 +  alcohol (g/100g EP)\*7 + dietary fibre (g/100g EP)\*2

**Eq.6.1.**. Beta-Carotene eq. (mcg/100g) = 1\*Beta-carotene
(mcg/100g) + 0.5\* Alpha-carotene (mcg/100g) + 0.5\* Beta-cryptoxanthin
(mcg/100g)

**Eq.6.2** Vitamin A, retinol eq. (RE) (mcg/100g EP) = Retinol
(mcg/100g EP) + 1/6\* Beta-Carotene eq. (mcg/100g EP)

**Eq.6.3** Vitamin A, retinol activity eq. (RAE) (mcg/100g EP) = Retinol (mcg/100g EP) + 1/12\* Beta-Carotene eq. (mcg/100g EP)

\Eq.8.3a Retinol (mcg/100g EP) = Vitamin A, retinol activity eq. (RAE) (mcg/100g) - 1/12\* Beta-Carotene eq. (mcg/100g EP)

\Eq.8.3b Retinol (mcg/100g EP) = 

\Eq.9.1 Niacin (mcg/100g EP) = 


#### 3.4. Combining Tagnames <br>

Some food components could be reported using more than one Tagnames (as
described in the renaming section and table 3). Of nutrients selected for review some could be expressed using different
Tagnames, depending on: the fraction analysed (e.g., Vitamin D3, Vitamin
D2), or the method of analysis (e.g., VITB6A, VITB6C). When possible,
they were standardised by combining values from similar Tagnames such as
Vitamin B6 or total fat into a `_standardised` variable.

#### 3.5. Imputing values <br>

Data imputation was avoided whenever it was possible (i.e., when mean value for each ICS SUA fishery categories were available (n=>1). In the cases when this condition was not met, a case-by-case approach was taken and it was documented here (See Section XX) and in the final Fisheries Global NCT was docummented in the column `comment`. 

##### Generating functions for data transformation <br>

**Special values**: We generated a function (`no_brackets_tr`) to be
called to change trace and below the detection limit values to zero, and
to remove brackets (see functions.R).

**Combining variables**: The variables `VITB6_mg_standardised`, `FAT_g_standardised` and `THIAmg_std` were generated by using a function.

**Calculating variables**: For instance, Vitamin A, retinol
eq.(mcg/100g) and Beta-Carotene eq.(mcg/100g) were calculated using a
function for the weighted sum of the listed variables. Including one of the special cases, for instance, `RETOLmcg_Recalculator()` was used to
fill up retinol missing values by back-calculation from Vitamin A (RAE) and Beta-Carotene equivalent.

Here's the list of the standardised variables as reported in the
Fisheries Global NCT, 2022 (Feb., 2022), of which all except vitaimn E (VITEmg), food folate (FOLDFEmcg), niacin eq. (NIAEQmg), niacin from tryptophan (NIATRPmg) and vitamin D (VITDmg) were reported and calculated by functions developed to generate them in
the Fisheries Global NCT, 2022 (Oct., 2022).

-   SOP_own = Sum of Proximate
-   ENERCkJ_standardised
-   ENERCkcal_standardised
-   CHOAVLDFg_standardised
-   FAT_g\_standardised
-   FIBTGg_standardised
-   VITAmcg_standardised
-   VITA_RAEmcg_standardised
-   CARTBEQmcg_standardised
-   VITEmg_standardised
-   THIAmg_standardised
-   FOLDFEmcg_standardised
-   VITB6_mg_standardised
-   NIAEQmg_standadised
-   NIATRIPmg_standardised
-   VITDmg_standardised



### 4. Data visualisation

#### 4.1. Checking Tagnames for completeness <br>

We checked the number of missing values per food component using data
visualisation packages. We used the *package naniar*(@ref-naniar) for visualising missing
values by ICS SUA fishery category and by FCT. This allowed us to
identify any typos or mistakes when renaming the food components, and
also to identify potential food components that could be excluded due to
the high number of missing values. Similarly the need for using
imputation techniques (see \Section 3.5 & \Section ).

#### 4.2. Checking quality of the values <br>

We used histograms and boxplot to identify extreme values by plotting
the different components by fish type and fish preparation. These two
variables were created for data visualisation purposes and did not make
it to the final dataset: Fisheries Global NCT (Oct., 2022).

### 5. Exporting data and metadata

All these steps would allow to replicate the process and to re-generate the table with the same format for future updates. 

#### 5.1. Formatting the data 

After all the values were evaluated, particularly the mean values of each food component per ICS SUA category, the data library was formatted to be exported into a
human-friendly format (e.g. Excel).

First, a summary row was generated for each ICA SUA category which
contained the final mean value for each food component of interest.
Additionally, some food components were recalculated at the summary row.

### Nutrient to be calculated at the summary row:

1)  SOP own
2)  Energy (kcal)
3)  Energy (kJ)
4)  Carbohydates by difference (g)
5)  Vitamin A RAE (mcg) 
6)  Vitamin A RA (mcg)

Finally, information was added regarding the ICS SUA fishery categories description and edible portion were added from the previous version to the generate the Fisheries Global NCT. 

### 6. Updating Fisheries Global NCT

Final adjustment were carried to mantain the format of the previous version of the Fisheties Global NCT.  

# Results

### 1. Importing FCTs

Of the thirteen FCTs previously identified, the UP17 was not processed because it did not contain information for fisheries, three FCTs were not publicly available and, we
requested access to the FAO Team (\Table 2). Access was granted and was covered by
the data sharing agreement. In addition, because the FCTs included were
previously reviewed by the FAO team, there was no need of checking the
overall quality of the FCTs. One new FCT was added to the final selection of FCTs (NO21) which provided information on fisheries, including information on DHA and EPA. 

Hence, we extracted information on all the components available in the 12 FCTs,
however particular attention have been given to the following: Cu, I, Se, Vit. B6, Vit. B12, Vit. D, Niacin, DHA, EPA, as the were not reviewed in the previous version of the Fisheries Global NCT. 

### 2. Tidying the data

The data cleaning operations were done by individual annotated R scripts for each FCT and were stored, together the raw data (raw FCT files), in a folder with its biblioID (See Table 2). Details on the operations and decisions made during the data cleaning are presented in subsequent sections. 

#### 2.1. Renaming variables

Food component names and descriptions were examined in each FCT and renamed with the corresponding Tagnames.

Some FCTs reported the food components using the Tagnames which were checked, extracted and used to rename
the food components. Tagnames were found in different formats, hence some name harmonisation was still needed.

-   In the AU19, it was expressed as part of the variable name. For instance, 
    "Moisture (water) (WATER) (g)", being the Tagname `WATERg`.

-   Similarly, in the IN17 which was obtained from the sharing agreement
    with the FAO team, the Tagnames were available in the FCT and
    complemented with the FCT documentation [REF]. Note that a great
    number of organic acids were reported (Table 9, from column 123), of
    which very few Tagnames were available.

-   In the JA15, Tagnames were also self-contained in original FCT file.
    However, manual renaming of some components, as it was done for the
    IN17, was needed. For instance, "Protein, calculated from reference
    nitrogen_g" to `PROCNTg`, "Lipid_g" to `FATg`, and "Carbohydrate,
    total, calculated by difference_g" to `CHOAVLDFg`.

-   In KE18, Tagnames were also self-contained in the original database
    and also have been previously reviewed for the MAPS project. Only
    small fixes were needed to be adapted for this project (i.e., adding
    the units along the Tagnames or filtering columns that were mostly
    empty (FA)).

-   In WA19, Tagnames were provided and, as for KE18, has been
    previously reviewed and pre-processed for MAPS. Note that the edible
    portion is divided into two variables: "EDIBLE1" and "EDIBLE2", we
    are using "EDIBLE1" as the `Edible_factor_in_FCT` variable following
    FAO Fisheries Global NCT, 2022.

-   In BR11, Tagnames were provided by the FAO team as it was previously
    processed. Hence, only renaming of the information variables (e.g.,
    "food id" = fdc_id) was needed.

-   In UF16, it included Taganames and we only needed to rename "Edible
    coefficient, from whole to fillet/flesh (EDIBLE1)" to
    `Edible_factor_in_FCT`, following what was reported in the FAO
    Fisheries Global NCT, 2022,and as it was done in WA19.

For others datasets included, Tagnames were not reported and they needed
to be generated using the information reported in the Fisheries Global
NCT, 2022, and the documentation accompanying each FCT.

-   In the DK19 documentation
    [REF](https://frida.fooddata.dk/pdf/en-frida-2-introduction_20-12-2016-esax.pdf),
    we found that the variable named as "vitamin A (RE)" was in reality
    the Vitamin A RAE, and hence the corresponding Tagname was
    `VITA_RAEmg`, similarly "vitamin D" was `VITDEQmg`, according to
    DK19 documentation and FAO/INFOODS, 2012.

-   In NZ18, renaming was manually done. Information about Vit. D was
    insufficient to certainly know the Vit. D fraction reported in the
    FCT.

-   In the UK21, Tagnames were added manually. In addition, some things
    that were noted were: Alcohol was reported as volumen (Alcohol (ALC)
    g/ mL (w/v)). We did not transformed the units because: 1) alcohol
    was not included as one of the NVs to be reviewed and, 2) we finally
    did not include this FCT into the final Fishery Global NCT, 2022.
    However, for the future, if we want to change to match the 100g EP
    values, we could re-calculate ALC variable by using Eq.1 and the
    density of each food which is provided in the FCT
    (specific_gravity). Vitamin D was renamed to `VITDmg`, however
    re-calculation using D3 and 25-hydroxy D3 values would be
    recommended when possible. Finally, for the DHA and EPA, we used
    cis- version, but it should be reviewed. This was based on the
    documentation available in the Composition of Foods integrated
    dataset: PHE (Public Health England) (2021) Composition of foods
    integrated dataset (CoFID). Available at:
    <https://www.gov.uk/government/publications/composition-of-foods-integrated-dataset-cofid>
    (accessed 28/03/2022).

-   In the US19, renaming was also done manually and based on the
    documentation and the information provided in the Fisheries Global
    NCT, 2022. We identified the Tagnames in one of the attached files,
    hence for the future a comparison/ update using those Tagnames could
    be done.

-   In BA13 we renamed the variables to the Tagnames manually, Vitamin E
    (reported as "VITE") definition was not clear and hence, in future
    should be checked.

-   In NO21, variables were manually renamed to the Tagnames. This was
    included for this project hence a more in-depth review of each
    component was needed and it is described in the **Section X.X of the
    NO21 documentation**

#### 2.2. Other tidying operations

##### Removing parentheses and brackets <br>

In JA15, parentheses were used to denote "estimated values". According
to JA15 documentation, those were used to "Composition values estimated
based on values listed in the food composition tables of foreign
countries, raw material blending ratio recipe, etc. are indicated by
placing them in parentheses. For some of Cereals, Fruits and Mushrooms,
composition values derived from estimation or calculation using the
listed values of similar foods are indicated by placing them in
parentheses." (REF).

In KE18, brackets ("[]") denoting not preferred values, as for the KE18
reporting: "For alternative analytical method or lower quality. Data
from non-preferred Tagnames were presented only where preferred Tagnames
data was not available." (REF).

Bracket for low quality values were removed or generated a new column
with the alternative analytical method for UF16, WA19 and KE18. In
addition, for the later, a star ("\*") was used to identify items
fortified with folic acid. Note some issues on the reporting of this
fortification were found previously, however the data was not reviewed
in-depth because folate and related food components were outside the scope of this
work. When we removed the brackets, for future development accounting
for the impact of the "estimated values" should be studied.

##### Food groups <br>

Each FCT has its own food groups, for instance in some FCTs were useful
for identifying fishery and fishery products. For instance in UK21
fisheries were divided into five food groups: "White fish (JA)", "Fatty
fish (JC)", "Crustacea (JK)", "Molluscs (JM)", and "Fish products and
dishes (JR)". The id (`fcd_id`) could be used as well to identify as all
fisheries, as all started with "16".

### 3. Transforming values

#### 3.1. Characters in nutrient values <br>

Trace and/or below detection limit were reported and converted to zero
in the following FCTs: IN17 ("\<LOD"), BA13, BR11, JA15 ("Tr"), and
KE18, UK21, and WA19 ("tr").

Characters and symbols were used to report missing values were "nv" in
DK19, "-" in JA15, and "M" in NO21 which were all transformed to `NA`. Similarly, nutrients present in significant quantities (not trace), but without reliable information on the amount, were reported in UK21 as "N" which were converted to `NA`.

#### 3.2 & 3.3. Unit conversions and re-calculation <br>

Some components were reported in different units as the recommended units in
the Tagnames, hence unit conversion operations were performed. For
instance:

In US19, Tryptophan was reported in g/100g EP which was converted to mg/100g. In addition, Vitamin A was reported as vitamin A (IU). Hence, when retinol and carotenoids were available, vitamin A (`VITAmcg`) was calculated using those values and the function:`VITAmcg_std_creator()`. However, these components were not available for around 800 food entries, hence an assumption of "all vitamin A was retinol" was used and Vitamn A was calculated using the conversion factor (0.3) proposed in the FAO / INFOODS Guidelines Guidelines for Converting Units, Denominators and Expressions Version 1.0 [@fao/units] for over 400 food entries.

In the IN17, fatty acids needed to be converted from mg/100g EP to g/
100g EP, and amino acids from g/100g PROT to mg/100g EP (Eq.2.3).

Similarly, in JA15, we need to change the unit of the fatty acids from
mg to g, and the edible portion was calculated from refuse (Eq.3.1).

Moreover, when (substantial) changes, like those mentioned above, were
made to the values reported in the original FCT, documentation was done
on GitHub so future users could review our decisions:

Documentation in GitHub

[Issue\\#9](https://github.com/LuciaSegovia/UoN-FAO/issues/9),
[Issue\\#10](https://github.com/LuciaSegovia/UoN-FAO/issues/10).

#### 3.3. Merging all the data together <br>

Once the FCTs were loaded and harmonised, we combined them into a single data library. 

###### 3.3.1. Allocating the FAO codes: ISSCAAP, alpha-three, and ICS FAOSTAT.

Fish matching between FCTs fish entries and ICS FAOSTAT, alpha-three
code and ISSCAAP code was previously done in the Fishery Global NCT,
2022. Hence, we used that information to generate a dataset which
contained information for each fish entry about ISSCAAP, ICS FAOSTAT and
alpha-three codes ("ics-code_fish-code.csv"). The dataframe
`ics_code_file` contained the information in the following variables:
`ICS.FAOSTAT.SUA.Current.Code`, `source_fct`, `NDB_number`, `fdc_id`,
`Food.description`, `Scientific.name`, `ISSCAAP.Group`, and
`X3.alpha.code`.

Minor adjustment were needed, for instance, the food id of KE18 in the
Fishery Global NCT, 2022 were as in the "original" (raw) KE18 (e.g.,
"0807"). In order to match the KE18 ids. in our dataset, we removed the
first "0" (e.g., "807"). For the US19, we needed to change the `fdc_id`
to `NDB_number`. Then, we merged `ics_code_file` (the dataset derived
from Fishery Global NCT, 2022) and the newly Fisheries nutrient table
(`fish_fct`) by each fish entry id. (`fdc_id`). That operation resulted
in a dataset with all the fishery products and its corresponding ICS
FAOSTAT code, alpha-three code and ISSCAAP code.

The UK21 was excluded from the Fishery Global NCT, 2022 hence ICS
FAOSTAT code were not available for the fish in that FCT.

After all the merging operations, only fish with information on ICS code
were kept, hence, around 318 fish entries were filtered out, mainly from
UK21 but some from [NO21](see NO21_docu.R) as well

```{r, loading-data, include=FALSE}

source("variable_re-calculation.R")

fish_fct %>% filter(is.na(ICS.FAOSTAT.SUA.Current.Code)) %>% count(source_fct)

```

#### 3.4. Combined variables (standardised) <br>

After merging and filtering the fishes, and before calculating the mean
nutrient values of each ICS FAOSTAT fishery category some variables needed to be recalculated and/or standardised.

Here's the list of the standardised variables as reported in the
Fisheries Global NCT, 2022, the following:

-   SOP_own 
-   ENERCkJ_standardised
-   ENERCkcal_standardised
-   CHOAVLDFg_standardised
-   FAT_g\_standardised
-   FIBTGg_standardised
-   VITAmcg_standardised
-   VITA_RAEmcg_standardised
-   CARTBEQmcg_standardised
-   THIAmg_standardised
-   VITB6_mg_standardised
-   NIAmcg_standardised

In addition, two special cases are reported here: ASHg_std and RETOLmcg, which were both recalculated. All of which used functions that were generated to re-calculate the variables using the equations in the section 3.3 of this document and can be found in
"functions.R".

##### 3.4.1. Sum of proximate (SOP)

Sum of proximate was not reported by all FCTs. Therefore, it was
re-calculated using the equation reported in the methods section
(@eq-5). Additionally, it was calculated at ICS (SUA) fish category
level.

Sum of proximate (=Σof water + protein + fat + available carbohydrates +
dietary fibre + alcohol + ash)

Ranges: Preferable: 97 - 103g (Greenfield and Southgate, 2003,
FAO/INFOODS, 2012)). Acceptable: 95 - 105g (FAO/INFOODS, 2012))

##### 3.4.2. Energy

Of the nutrients used to calculate energy, the most important for fish
and fish products are proteins, fat, water and carbohydrates. Hence, the
review of those components should be carried more in-depth than the
other, fibre, and alcohol could be assumed zero, for most of fish and
shellfish products, with the exceptions of preparations, canned, cured
and/or molluscs (FAO/INFOODS, 2012).

We will generate a function that will calculate energy in kcal and
energy in kj using the FAO conversion factors and the fao tagnames that
will be used to generate the columns: `ENERCkJ_standardized` and
`ENERCkcal_standardized` for the FAO fishery products database and for
MAPS to calculate energy used.

##### 3.4.4. Carbohydrates by difference

Carbohydrates by difference were calculated using the Eq.6a. In NO21, the value of ash (g/100g EP) used were calculated. In addition, we found `r round(sum(str_detect(fao_fish_fct$comment, "CHOAVLDFg_std assumed zero"), na.rm = T)/length(fao_fish_fct$CHOAVLDFg_std)*100)`% of negative values of carbohydrates by difference which were converted to zero and added a comment "CHOAVLDFg_std assumed zero" for documentation. 

The documentation of these changes are important as they would have an impact of the final estimates, particularly as this variable is used to calculate SOP, and more importantly the total energy. If total energy is calculated using negative values it would lead to a underestimation of the total energy supplied by the foods.

##### 3.4.3. Fat

We combined three Tagnames into `FAT_g_standardised` as reported in section 3.4. We checked the contribution from each of the fractions Table \@ref(tab:fat).

```{r fat,  echo=FALSE}

fao_fish_fct %>% select(starts_with("FAT"), -FATRNg) %>% summarise_all(., ~sum(!is.na(.))/sum(!is.na(fao_fish_fct$FAT_g_standardised))*100) %>% round(.,2) %>% knitr::kable(., caption = "The table present the percentage of each fat tagname contribution to the total.")


```

##### 3.4.3. Ash

Ash values were reported in all FCTs but the NO21 which was calculated
from the carbohydrate by difference equation (Eq.3.4b). Full information was
reported elsewhere (NO21_docu.Rmd). We combined `ASHg` (reported in the
FCTs) and `ASHg_bydiff` into one variable `ASHg_std`.

##### 3.4.3. Fibre

The value of fibre standardised was calculated using only values from the dietary fibre (`FIBTGg`), as no other fractions provided information when dietary fibre  was missing values. Fibre, crude (FIBCg) could not be used to complete missing values in FIBTGg, as FIBCg did not added information on any missing (FIBGTg). For more details, check the section 4.2.8.

##### 3.4.3. Vitamin A (RE) and (RAE)

These two variables were re-calculated using the function `VITAmcg_std_creator()` and `VITA_RAEmcg_std_creator()` which used the variables `RETOLmcg` and `CARTBEQmcg_std` as inputs.

##### 3.4.3. Beta-Carotene equivalents

This was a calculated variable, hence when possible (i.e, when the
carotenoids were reported), re-calculation was preformed using the function `CARTBEQmcg_std_creator()` and stored in the variable `CARTEBEQmcg_std`. This ensures that we
avoid propagation of error across data sources. However, this was not
always possible hence some values were extracted from the Beta-Carotent Eq. (`CARTEBEQmcg`) from the FCTs, and other were back calculated from the retinol and Vitamin A (RAE) as described
in the method section 3.4.

Some constrains of using this back-calculation was that there were
some cases where retinol was greater that Vitamin RAE, this affected to
19 fisheries entries, but were only 7 unique fisheries entries. We then
transformed negative values to zero, assuming that if Vitamin A was
smaller than the retinol value, then no carotene would be presented.

##### 3.4.3. Retinol

Retinol should be provided by the FCT, and ideally it would be analysed. However, there were some cases that retinol was missing, however values for Vitamin A and Beta-Carotene eq. were provide. Therefore, we used the function `RETOLmcg_Recalculator()` to re-calculate the
missing values. Additionally, the function add the documentation (i.e., "RETOLmcg value re-calulated from VITA_RAEmcg and CARTBEQmcg" or "RETOLmcg value re-calulated from VITA_RAEmcg and VITAmcg" in the `comment`). Again, this is important to 1) identify data gaps, and 2) flagging potential issues with the data. 

##### 3.4.3. Vitamin B6 

Similarly as it was performed with the fat, Vit. B6 was reported separated into three Tagnames. Most of the FCTs used analytical values (`VITB6Amg`), followed by calculated (`VITB6Cmg`) and only the NO21 used a mixed of values (`VITB6_mg`).
Then, the three Tagnames (variables) were combined into a new variable: `VITB6C_mg_standardised` as reported in the method section 3.4. 

##### 3.4.3. Thiamine

Thiamine was combined into the Thiamine standardised variable (`THIAmg_std`) using the function `THIAmg_std_creator()` as reported in the method section 3.4.

##### 3.4.3. Niacin 

Niacin (`NIAmg`) was reported in all FCTs but in WA19, in
which niacin equivalent (`NIAEQmg`) was reported. Because tryptophan was
reported in the WA19, `NIAmg` was re-calculated into a new variable and combined into the Niacin standardised variable (`NIAmg_std`) using the function:`nia_conversion_creator` as reported in the method section 3.4.

## REVIEW

##### 4. Visualising food components for decision-making

After standardising and recalculating the variables, and before calculating the mean
nutrient values of each ICS FAOSTAT fishery category, we visualised the
data (e.g., data availability) and performed quality check for the
nutrient values of interest (Cu, I, Se, Niacin, Vit.B6, Vit. B12, Vit.
D, DHA, EPA). Visualisation scripts are reported in `visualisation.R`
and quality check are reported in `QC.R`.

###### 4.1. Nutrient avaibility for Fisheries Global NCT extension

We evaluated the availability of ten nutrients to extend the Fisheries Global NCT. In figure 1 @fig-1, we can see that Cu and Vit. B6 were reported by all FCTs but
KE18, with overall very high data availability with very few missing
values. In contrast, I and Vit. D were reported only in six FCTs, and DHA and EPA were in
seven. 

```{r fig-1, fig.cap= "Figure 1: Percentage of missing values per component and food composition table.", echo=FALSE}


#├ Plot (heat map): % of missing values per FCT ----

components <- c( "WATERg", "F22D6N3g",
  "F20D5N3g",
  "VITB6Amg",
  "VITB6Cmg",
  "VITB6_mg",
 "VITB6_mg_standardised",
 "NIAmg_std",
  "NIAEQmg",
  "NIAmg",
  "NIATRPmg",
  "TRPmg",
  "VITB12mcg",
  "VITDEQmcg",
  "VITDmcg",
  "CHOCALmcg",
  "ERGCALmcg",
  "CHOCALOHmcg",
  "ERGCALOHmcg",
  "CUmg",
  "SEmcg",
  "IDmcg" )

fao_fish_fct %>% select(components, source_fct) %>% 
  naniar::gg_miss_fct(., fct = source_fct)  +
  labs( x= "", y= "", title = "Data Gaps: Percentage (%) of missing values of selected components in each FCT")

```

**Figure 1: Percentage of missing values per component and FCT**

However, some FCTs contributed to the overal NCT with more fisheries entries, hence we checked the overall availability as percentage of the overall fisheries entries. In figure 2, we can see that Cu, Vit. B6 and niacin had high coverage with more than 75% of the fish entries reporting a value for those components. While for DHA, EPA and Se had a moderate coverage with over 60% of the fish entries reporting a value. Finally, vitamin D and I were excluded from the extension. 

```{r, fig-2, fig.cap= "Figure 2: Coverage: Percentage of reported values per component.", message=FALSE}

#├ Plot (bar chart): Coverage ----

fao_fish_fct %>% select(1:10, components) %>% 
  mutate_at(components, as.numeric) %>% 
  pivot_longer(cols = all_of(components),
               names_to = "NV", 
               values_to = "n") %>% 
  filter(!is.na(n)) %>% 
  group_by(NV) %>% 
  summarise(total = n()) %>%
  ungroup() %>% 
  mutate(perc = total/nrow(fao_fish_fct), 
         cat = ifelse(perc >.75, 
                      "high", 
                      ifelse(perc < 0.45, 
                             "poor", "medium" ))) %>% 
  ggplot(aes(x=reorder(NV, perc), y = perc*100, fill = as.factor(cat))) +
  geom_bar(stat = "identity") +
  theme_light() +
  coord_flip() +
  scale_fill_manual("Coverage",
  values=c("darkolivegreen3","lightgoldenrod2", "red4"), 
  labels = c("High (> 75%)", "Medium (75-45%)", "Poor (<45%)")) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank()) +
  labs( x= "", y= "", title = "Availability of data: Percentage (%) of fish entries with values of selected components")

```

**Figure 2: Coverage: Percentage of reported values per component**

###### 4.2. Data avaibility per each ICS FAOSTAT fish category


**Table 3: Count of values per component and SUA fish category**

```{r, visual-tab4, echo=FALSE}

```


```{r tab-4, }
fao_fish_summary %>% relocate(ics_faostat_sua_english_description, 
                              .before = WATERg_n) %>%  arrange(desc(WATERg_n)) %>% 
  rename("Fish categories" = ics_faostat_sua_english_description,
   "Water" = WATERg_n,
     "Vitamin B6" = VITB6_mg_standardised_n,
    "Vitamin B12" = VITB12mcg_n, 
   "Selenium" = SEmcg_n, 
    "Niacin" = NIAmg_std_n, 
    "DHA" = F22D6N3g_n,
     "EPA" = F20D5N3g_n, 
    "Copper" = CUmg_n) %>% 
 
  knitr::kable()

  missing <- c("Cephalopods, cured", "Aquatic animals nei, cured", 
               "Aquatic animals nei, preparations nei", "Crustaceans, cured", 
               "Cephalopods, canned")

```

After we agreed on the components to be expanded in the Fisheries Global NCT, we evaluated the availability of data by ICS FAO fishery category. In \Table 4, the number of fisheries reporting a value in each ICS SUA fish category and per each nutrient are shown. Only four SUA fish categories had no values for
Se concentration: `r toString(missing)`. Hence, we imputed some values
from other fish entries in the compiled NCT. The scripts that impute the values are
reported in `missing.R`, and in the `comment` variable in the Fisheries Global NCT (Oct, 2022) and the rationale is outline bellow.

For **Cephalopods, cured**, we used the water-adjusted Se mean
concentration of the items reported in table 5 to "complete" the Se
concentration of the following "Cephalopods, cured":

[1] "Mollusks, firefly squid, seasoned and smoked"\
[2] "Mollusks, processed squid,"Surume" dried squid"\
[3] "Mollusks, processed squid,"Saki-ika" dried, seasoned and shredded
squid"\
[4] "Mollusks, processed squid, seasoned and smoked"\

**Table 5**. Cephalopods used to impute Se values for "cephalopods,
cured"

| fcd_id | food_desc                                                      | WATERg | SEmcg | source_fct |
|--------|----------------------------------------------------------------|--------|-------|------------|
| 10342  | Mollusks, neon flying squid, raw                               | 79.3   | 28    | JA15       |
| 10345  | Mollusks, Japanese common squid, raw "Syn. short-finned squid" | 80.2   | 41    | JA15       |

For **Cephalopods, canned**, there was only one item under that
category: *"Mollusks, Escargot Apple snails, canned in brine"*. However
that item should be recorded under "Molluscs, excluding cephalopods",
according to the description in the documentation (REF). Hence, to
populate this SUA category, we decided to use the cephalods entries from
"preparations nei", which were described as "boiled/ moist heat" (n=22)
(table 5). This was decided based on:

a)  The description of *Cephalopods, Canned* in the FAO documentation,
    which is \>"Raw or precooked meat from gutted or ungutted animals,
    canned in brine, oil or other medium (all edible) treated at
    temperatures adequate to ensure sterilization. Examples are:
    vacuum-packed small octopus, canned squid in own ink or oil.". \>

b)  Nutrient values reported on the Spanish FCT [ref] for "squids,
    fresh" and "squids, canned" were very similar. Unfortunately, there
    was no information for Se.

c)  Same fish type would have more similar composition, despite the
    cooking method, than a different fish, particularly when they are
    divided into distinct SUA categories.

d)  In addition, when perfect match is not possible the mean of several
    foods is recommended over a single food match (FAO/INFOODS, 2012).

**Table 5**: List of cephalopods imputed to generate the "Cephalopods,
canned" SUA category.

```{r, table cephalopods-boiled}

fao_fish_fct$WATERg <- as.numeric(fao_fish_fct$WATERg)
fao_fish_fct$SEmcg <- as.numeric(fao_fish_fct$SEmcg)

  fao_fish_fct %>% 
    filter(fish_type == "Cephalopods", 
           fish_prep %in% c("preparations nei"), 
           str_detect(food_desc, "boil|moist"), 
           #  source_fct == "JA15",
           !is.na(SEmcg)) %>%
    select(fdc_id,food_desc, WATERg,  SEmcg, source_fct) %>% 
 #   mutate_at(c("WATERg", "SEmcg"), as.numeric) %>% 
    mutate_if(is.numeric, ~round(., 2)) %>% 
    knitr::kable()

```

NOTE: There are some concerns related to the edible portion, for
instance in fish described as "canned", we are assuming that all content
is edible, and hence of the 100g of canned squid, X% would be squid and
Y% medium (e.g., sauce, oil, etc.). This is not captured by boiled which
is assuming 100% edible squid.

For **Aquatic animals, nei, cured and preparation nei**, when we checked
the items included in these two categories, there were mostly Sea
urchin, jellyfish, sea cucumber and sea squirt from the JA15.

However, when we reviewed the fish entries with Se values included in
the "Aquatic animals, nei, fresh" category, we realised that it was very
diverse category, including from crocodiles to sea cucumber. The only Se
information that was available and comparable was for sea cucumber, thus
we water-adjusted the Se concentration of: "Sea cucumber, raw" (`WATERg`
= 92.2, `SEmcg` = 37) for imputing the Se concentration in:

[1] "Sea cucumber,"Konowata" salted and fermented viscera"\
[2] "Sea urchin,"Tsubu-uni" salted whole gonads"\
[3] "Sea urchin,"Neri-uni" salted whole gonad paste"\
[4] "Jellyfish, Salted, desalted"\
[5] "Sea squirt,"Shiokara" salted and fermented meat and viscera (Syn.
Ascidian)"\

For **Crustaceans, cured**, we needed to impute Se concentration for
"Crustacean, Sakura shrimp, dried", for which we used (10415)
"Crustacean, whiteleg shrimp, raw" (`WATERg` = 78.60, `SEmcg` = 27).
And, for "Shrimp (crayfish), whole, dried", we calculated mean of the
values reported in table 6. These values were selected based on:

1)  They were the same fish item: Shrimp (crayfish).
2)  UF1(092004) value was reported in the references "Shrimp (crayfish),
    whole, dried".

**Table 6**: List of fish entries used to imputed to Se concentration
for "Shrimp (crayfish), whole, dried".

```{r, table crayfish-dried}

#id list
  crayfish <- fao_fish_fct %>% 
    filter(fish_type == "Crustaceans", 
           fish_prep == "fresh",
           source_fct == "UF16" ,
           !is.na(SEmcg),
           str_detect(food_desc, "crayfish|Crayfish" )) %>% pull(fdc_id)
  
  crayfish[4] <- "092004" #Adding this from the ref. list

  fao_fish_fct %>% 
    filter(fdc_id %in% crayfish) %>%
    select(fdc_id,food_desc, WATERg,  SEmcg, source_fct) %>% 
    mutate_at(c("WATERg", "SEmcg"), as.numeric) %>% 
    mutate_if(is.numeric, ~round(., 2)) %>% 
    distinct() %>% 
    knitr::kable()

```

Finally, values were not adjusted for any retaining factor as according
to Vásquez-Caicedo et al. (2008) and Bognar (2002), retention factors
for Se are between 0.9-1, with dry heat (braise, fry in oven, broiling,
grilling) being 1.

Information regarding the values used to impute/calculate the `SEmcg`
for the items can be found in the column `comment`.

###### 4.2. Data quality per each ICS FAOSTAT fish category

###### 4.2.1. Niacin

We check for "extreme values", and after plotting the values, we
identified some potential "extreme values". However after comparing
these values with similar fish product, all the values seemed plausible.
For example, one of the high value was smoke-dried and fermented fish
(i.e., low water concentration). When the niacin concentration was
compared on dry-weight basis concentration with similar fresh items, the
niacin concentration was similar.

Note that for "Other pelagic fish, cured", one of the high values had a
great influence in the final mean value. For instance, when we removed
values that were higher than 40mg/100g, the mean of that SUA category
was 15mg/100g instead of 30mg/100g (range:15-45mg/100g). This could be
solved by including more fish entries (more values) for that fish
category, as currently there are only two entries for that category.

The rest of the SUA categories remained more or less the same.

###### 4.2.2. Copper

Similarly for Cu, we identified items that had the highest values:
Octopus from IN17 (fdc_id = R003) which looked very high, even when
compared with other octopus values. Double-check the value.

Oyster from UF16 (fdc_id = 093013) also seems high compared with other
oyster but seems plausible given the type of food. For instance, of the
10 items with the highest Cu concentration, 4 were oyster.

Another item from the JA15 (fdc_id = 10350) was also extremely high,
however when we compared it with the "fresh" values, it was still in
line with the water content of that item. However, because the item was
driving the very high mean for the category "Cephalopods, cured", (mean
=
`r mean(as.numeric(fao_fish_fct$CUmg[fao_fish_fct$ics_faostat_sua_english_description == "Cephalopods, cured"]))`)
we decided to remove it from the final mean, which yielded more nuanced
value (mean =
`r round(mean(as.numeric(fao_fish_fct$CUmg[fao_fish_fct$ics_faostat_sua_english_description == "Cephalopods, cured" & fao_fish_fct$fdc_id != "10350"])),2)`).
For future, and in order to minimise the influence of this type of food
items, more values should be sought for each category.

###### 4.2.3. Vitamin B6

After combining the values of the three Tagnames into one Vitamin B6 (standardised), it was reported in all but one FCT (KE18). Overall, values were within plausible values. The highest values reported were for Tuna and
they were still within normal ranges.

###### 4.2.4. Vitamin B12

Vitamin B12 was reported in nine FCTs. JA15 seemed to report higher
values than the other FCTs, including most of the high-end values.

We found that "Molluscs, excluding cephalopods, frozen", "Molluscs,
excluding cephalopods, fresh", and "Molluscs, excluding cephalopods,
canned" had the highest Vit. B12 values. We found that clams from JA15
had the highest values for the "Molluscs, excluding cephalopods,
frozen". However, when we plotted the data it seemed to have a normal
distribution, and hence we are not considering them as outliers.

The category "Cephalopods, preparations nei" have very high variability,
it seemed that octopus had higher Vit.B12 than other cephalopods in the
category, also most of the high values were sourced from UF16, while the
highest was from US19. It maybe that the UF16 values were imputed from
US19.

###### 4.2.5 DHA

Of the seven FCTs that reported DHA, some extreme values could be seen in
the US19 and DK19 with values higher than 5g of DHA.

When we checked those extreme values, all of them (values \>4g of DHA per 100g of EP) were
reported in oils, hence they seemed plausible values. For the other
values higher than the 4th quantile, most corresponded to fish and preparation
with high fat content (\>5%) (@ref-infoods) and contained relatively low water content (\<70%) (@ref-infoods).

However when we checked the percentage of difference between fat content
of the items with DHA values and without, some concerning differences
were shown. This was particularly true for very heterogeneous SUA
categories were also limited number of items were included, for
instance, "Aquatic mammals, meat", "Aquatic animals nei, fresh". We
could not find values for DHA for those items in literature or other
FCTs, hence this remained as an area were improvements are needed.

"Aquatic plants, dried", there are many `NA`, however, for those that
values are available DHA is zero. Maybe we could "assume zero" for those
values.

###### 4.2.6. EPA

Results of the EPA checks were very similar to those for DHA.

###### 4.2.7. Selenium

When we checked the values one value, "Tuna, raw" (04.043) from the
NO21, seemed very high compared with other tuna values. There were other
high values but they seemed to be still within plausible ranges.

When we plotted the results by FCT, and by fish type we could see that
JA15 reported overall the highest Se median value with "extreme values",
coming consistently from that FCT, followed by NZ18. Some values of
those values are shown below.

`r subset(fao_fish_fct, fdc_id %in% c("T39", "04.043", "04.333", "04.107", "04.055"), select = c(fdc_id, food_desc, WATERg, SEmcg)) %>% knitr::kable(., digits=2)`

When we checked by SUA category, we identified the "Other pelagic fish,
cured" which had the highest mean value,only two fish entries and only
one Se value. Similarly, "Aquatic mammals, preparations nei" only
reported information for three entries of which only two had a `SEmcg`
value.

Similarly, the "Aquatic mammals, meat", only 3 have Se values out of 15
fish entries. Although, the mean value is on the higher end of the Se values, it is difficult to assess whether the value is a good representation of the category due to the due to the
lack of data availability.

For future improvement, we could use imputation technique to the overall mean of these SUA categories.

###### Other components

The addition of the NO21 involved the recalculation of twenty components that were previously reviewed in preceding Fisheries Global NCT. Therefore, data availability and quality check of those food components would be minimal. More attention would be put in maintaining the consitency of the results from the previous version and documenting the source of variation in the results. 

###### Edible portion

The edible portion used are based on some decision regarding the edible
portion information at the FAO fisheries and the FCT information.
However, information provided in the Fisheries Global NCT, 2022 is not
sufficient to replicate it in R.

We added the `Edible coefficient to be used` in the table at the summary row.



###### Water

It was reported by all the FCTs, and no issues were found. It was used
to validate the values againts the original Fisheries Global NCT, 2022
and to check that all datasets were correctly imported.



- Proteins values were reported for all the fishery entries included. No
major issues were found for this component.


- Carbohydrates: Five FCTs/FCDBs did not report CHOAVLDFg, of those, two reported CHOCDFg instead and other two reported CHOAVLg. CHOAVLDFg was recalculated using the function developed.


- Alcohol: Ten FCTs/FCDBs did not report ALCg, of the three that did report it,
    the mean value was zero. For the future, we can hence assume alcohol
    = zero for fish and products.


# - Fibre: The concentration of fibre in fish and other aquatic animals were mostly zero and/or `NA` when raw whereas preparations and canned were below 1g per 100g. Then, aquatic plants were on average higher than 1g up to 41g per 100g for aquatic plants preparations. 

Current mean of FIBTGg =
`fao_fish_fct %>% filter(!is.na(FIBTGg)) %>% pull(FIBTGg) %>% as.numeric() %>% mean(., na.rm = T)`.


For raw fishes, `NA` values for fibre could be assume equal to zero, as they may not be analysed based on the assumption that they will be zero for that food type. 

When we looked at (FAO) SUA fisheries categories fibre mean values, most of the values were zero, only "Aquatic Plants", "Aquatic Plants Dried" and "Aquatic Plants Preparations" contained more than 1g of fibre per 100g. 

Individual `NA` values (i.e., per fish entry) were assumed zero for energy and SOP, but they were "ignored" when calculating the category mean.

- Vitamin A (RE): This variable was reported in X datasets, and it was re-caluclated using the function `VITAmcg_std_creator()` into the vitamin A (retinol eq.) standardised variable (`VITAmcg_std`). 

- Beta-Carotene Eq.: Around 9 SUA fishery categories has high amount of missing values (over
80%), see in the missing values plots reported in `QC.R`.

- Retinol: It was provided in most of the FCTs, with only 115 entries having a
missing value which were mainly reported in BA13 followed by US19.
However, it was particularly problematic for Aquatic mammals (see Figure \@ref(fig:miss-retol)), for which led to between high
proportion of missing values (\>60%).

```{r miss-retol, fig.cap="Missing values for retinol by ICS SUA fisheries code.", echo=FALSE}

##├├ Plot: Missing values for retinol by ICS code 

fao_fish_fct$ICS.FAOSTAT.SUA.Current.Code <- as.factor(fao_fish_fct$ICS.FAOSTAT.SUA.Current.Code)

fao_fish_fct[,c( "RETOLmcg", "ICS.FAOSTAT.SUA.Current.Code")] %>%  #selecting variables
  naniar::gg_miss_fct(., fct = ICS.FAOSTAT.SUA.Current.Code) +
  coord_flip() +
  scale_x_discrete(guide = guide_axis(n.dodge = 3))


```



### Final Quality Checks

Because this FCT is an extension of a existing FCT, we need to perform
some extra-control steps to ensure that values are a good representation
of the data shown. We also need to perform those extra steps as we have
added some new fish entries, and hence, we need to make sure that
reconciliation with all the other nutrients are performed.

#### Water content, protein, Ca, and Fe (non-calculated)

As part of the data checks, as described above we compared the Fisheries
Global NCT, Feb, 2022 (For sharing) compiled using excel, and the
Fisheries Global NCT, Oct, 2022 compiled using R.

We compared the values generated with the R scripts with the results
that were generated and shared in excel file for a selection of
components. We did that to ensure that the scripting approach was not
introducing any systematic errors. Most of the values were identical or
with minor variation that could fall within rounding differences. There
were six SUA categories with "major" differences: "Marine fish nei,
canned", "Aquatic animals nei, preparations nei", "Aquatic mammals,
meat", "Marine fish nei, cured", "Freshwater & diadromous fish, fresh",
"Freshwater & diadromous fish, frozen, whole". The source of differences
were identified in consultation with the FAO team. The main source of
discrepancies were typos or `NA` values being filled up. This was a
great excersise as strengthen both approach helping to identify any
potential mistakes in the final Fisheries Global NCT.

#### DHA and EPA concentration

We calculated the mean and other summary statistics for the each fish
category, and only for the entries that reported the DHA and EPA. This
was done to evaluate the impact of missing values into the final
results.

We calculate the proportion of each fatty acid (DHA and EPA) to the
total fat, for all the fish entries and only for those with complete
values (i.e., reporting a value for `FAT_g_standardised`, `DHAg`, and
`EPAg`). Then, we compare the difference between the two. Note that we
used the `FAT_g_standardised` variable which is a combination of the
Tagnames (and different extractions): `FATg`, `FAT_g`, and `FATCEg`. The
use of FATCE is not recommended for use in unit conversion (FAO/INFOODS,
2012).However, as it is not going to be used to report values, and only
for checking, we proceed to compare the percentage of each FA for the
whole dataset and only those entries with FA values.

Eq.: FA(%) = FAg/FATg x 100 , (F22D6N3g_perc =
F22D6N3g/FAT_g\_standardised\*100)

There were major differences between the two datasets, particularly for
16 SUAs categories that reported \>10% difference in total fat between
values with DHA and EPA and those without. The main reason were that
those SUA category were were very broad, and hence the composition was
highly variable. Also, the number of entries were very small as they
were rare species (i.e., aquatic mammals, or aquatic plants).

We also calculate the percentage of relative coverage (number of entries
reporting FAT_g\_standardised/ number of entries reporting the DHA/EPA
\*100). Thirty-one and thirty-two fish categories had lower than 60%
coverage for DHA and EPA respectively.

#### Carbohydates and other re-calculated variables

Then, we evaluated the difference in `CHOVALDg_std` values between the
Fisheries Global NCT, 2022 (Feb) and the Fisheries Global NCT, 2022 (Oct).

Because CHOAVLDFg was re-calculated at Fishery (SUA) category, we
evaluate CHO w/ and w/o NO21 (as we did w/ FAT). Check which categories
are different (assuming prep).

We assumed that when CHOAVLDFg was negative, we assumed zero for both
dataset. "Major differences (\>0.5) were observed in six categories. The
first two (with 2.1 and 1.7 point of difference) were due to"assumed
zero" in the Fisheries Global NCT, 2022.

-   The first one ( 1590, Aquatic animals nei, preparations nei)
    consisted only in two entries from JA15 which were wrongly imported
    in the Fisheries Global NCT, 2022.

-   The second one, it seemed to be due to minor inconsistencies in the
    mean values of each proximate, as it shouldn't be different because
    there is no entry from NO21 which may cause differences, and also
    all individual values are the same. This is because of the use of
    "weighted mean" instead of "arithmetic mean".

-   For the third value (1520, Demersal, Preparations nes), new values
    were added (n=46) as preparation, some of which have relatively high
    CHO content due to the preparations (e.g., breaded and fried
    fillets), however the overall increase is still minor (from 0.4g to
    1.6g).

-   The fourth value was for 1531 - Pelagic fish, cured, the higher mean
    CHO value was driven by one value in the NO21: "Herring, pickled,
    cured, marinated, drained" (04.289). The value is in-line with other
    similar fish item reported in DK19 (). Although, the value seems
    plausible, we advise to not include the value in the CHO
    calculation, as it's driving the mean.

-   The fifth, 1533 - Pelagic fish, preparations nei, similarly to the
    previous point, three values from NO21 for "Herring, pickled" are
    driving the results. This rises two important points, 1) the
    classification of those "herring, pickled", and 2) more generally
    (and important), the use of mean values, which are extremely
    sensible to outliers/ extreme values.

-   Finally, the sixth was 1574 - Cephalopods, preparations nei, again
    the influence of two new "battered" items were driving the results.
    Although, due to the minor difference (i.e., less than 1g, 0.85g),
    we decided to keep all the values.

```{r}

hist(fao_fish_fct$CHOAVLDFg_std[fao_fish_fct$ICS.FAOSTAT.SUA.Current.Code == "1531"], main="Distribution of CHO values (including CHOAVLDFg and CHOAVLg) for pelagic fish, cured",
xlab = "Carbohydrates (g/100g) (including CHOAVLDFg and CHOAVLg)")

```

Most of the fishery products with CHO higher than zero are those within
preparations, nei and cured and canned. The only "fresh"/"frozen" items
with CHO \> 0g were moluscs (eg. snails). Because CHO (CHOAVg) was
analysed for NO21, ASHg were not reported thus, CHOAVLDFg could not be
calculated. We evaluated the impact of using a different CHO method to
the overall values. We could see that in NO21 there were some mean
values that were higher than in the Fisheries Global NO21. For example,
we found that within "Demersal fish, preparations nei" there quite
number of fish entries that were "breaded", thus the higher content in
CHO. However, when compared wit other breaded items, the values seemed
to be within range.

### TO-DO: Value imputation

One of the main source of variability found when comparing the Fisheries
Global NCT, Feb, 2022 (For sharing) compiled using excel, and the
Fisheries Global NCT, Oct, 2022 compiled using R were the imputed
values.

In this section we investigated some of the imputed values and the
potential impact on the final values.

##### Assumed zero values

**FIBTGg_std**

In the original Fisheries Global NCT,2022 there were some manually added
"zero" as assumed values. These values were imported those in our
dataset under "FIBTGg_std" variable. In addition, a comment was added
indicating that the fibre value was assumed.

For the future development, check FAO/INFOODS to identify food group
that may be "assumed" zero when calculating Carbohydrate by difference
and Energy.(see Next steps: Assumed zero section).





##### Recalculation from other components

**CARTBEQmcg**: Re-calculated from VITA_mcg and VITA_RAEmcg

 **VITAmcg**: Imputed/ Re-calculated from Vitamin A (IU) which
was imputed.

## Next steps: Functions development and improvemnts

#### Renaming variables

Overall - Allocate CDNO ontology codes to NV.

B13: - Get CARTBEQ or [CARTB] into two columns. - Remove function and
change to pre-loading functions from source(functions.R).

DK19 -Rename all other NV w/ Tagnames. -Find a better renaming way.

NZ18 -Rename all NV w/ Tagnames, including sugars and Fatty Acids.

US21 - Using data embeded in US21 to allocate the Tagnames for all NVs.

#### Characters in nutrient values

-   A function that generate different columns for different analytical
    method of the same/similar component. E.g., Extracting alternative
    analitycal method (i.e., NIA for Niacin) that are provided in the
    same column of the preferred analytical method (i.e., NIAEQ for
    Niacin) but within bracket.This type of data structure was observed
    in BA13, KE18, and WA19.

-   A function that extract the "estimated" values and/or low quality
    values between brackets or parenthesis, and it generate a metadata
    info on that. Eg. A new column with a string providing information
    on which values were low quality and/or estimated. This was observed
    in JA15, where the use of bracket to denote "estimated values". We
    removed the brackets but we should look at how to keep a record and
    the meaning of estimated values. In KE18, "Low quality" values were
    reported within brackets.

-   A function to change Trace values, expressed as "tr", "Tr", "\<LOD",
    to 0 (zero).

##### Functions improvement for the future:

For the future development, check FAO/INFOODS to identify food group that certain components (e.g., fibre, alcohol, etc.) may be "assumed" zero when calculating Carbohydrate by difference and Energy, otherwise it should flag it as "missing value" need attention (see also "Assumed zero").

For the function that re-calculate NIA, THIA and VITB6, documentation of the Tagname and/or re-calcuated value used should be added to the the documentation (`comment`). 

###### Dealing with missing nutrient values

##### Assumed zero

-Fibre: We could check whether they are listed under fish or fish
preparations. If preparations then check what type of preparation,
otherwise we could assume zero. Current mean of FIBTGg =
`r round(fao_fish_fct %>% filter(!is.na(FIBTGg)) %>% pull(FIBTGg) %>% as.numeric() %>% mean(., na.rm = T), 2)`.

-   Alcohol

-   CHOAVLDF for non-processed foods.


##### Imputing nutrient values

**Se concentration**: Mean mackerel fresh to (10157) (35055) with
(35164), by water-adjusting and assuming the oil has no contribution to
`Semcg`. Although, due to the low water content and overall high content
in Se of the category, it would only increase the mean.

#### Nutrient values

##### DHA and EPA

Fats and fatty acids concentration in fish and aquatic animals varies
widely. These components are very sensitive to many environmental,
seasonal and other changes. Hence, imputing missing values is not
optimal. Therefore, including more fishery entries with minimal missing
values should be sought in the future.

#### Niacin Eq.

Total niacin equivalent (NIAEQ) = niacin preformed (NIA) + 1/60
tryptophan (TRP)

#### Unit conversion

Unit conversion (when possible) to match Tagnames (per 100g EP FW)

-   Alcohol(w/v) to (w/100g) = ALC (g/100mL) / density (g/mL) = ALC
    (g/100 EP)
    
 




### 6. Updating the Fisheries Global NCT

Final data formatting operations were carried in excel. For instance, table headings were adjusted in excel to keep consistency with R format. If a column (variable) contain text would be converted into an object with class "character", which then would be exported into excel as text losing the decimals and the ability to do further calculations if needed. Similarly, background colours and conditional formatting were manually added in excel.

# Recommendations for the future

## More food composition analysis

## Food composition tables and data quality

-   FCT reusing food components: are we using the same value three times
    (e.g. in WA19 and KE18 imputed a value from IN17) what's the impact
    in the final mean? And, what do it mean for the (lack of)
    variability in certain food component for certain food/ fish items?
-   Information regarding data quality is sometimes provided in FCTs (e.g., using \\[\\] or other symbols to denote low quality), however most of the case this values are still used when generating NCTs (due to missing data). Could we account/ measure the impact of using this values in final estimates? Would be possible to generate a quality scale using these values? For example, could we count the number of low quality values (or the percentage) and establish a threshold for exclusion or at least to "flag" that estimate as highly uncertain. 

## Rethinking fisheries categories for nutrition

## Data imputation and impact of summary statistics

## Data documentation and data resuse

